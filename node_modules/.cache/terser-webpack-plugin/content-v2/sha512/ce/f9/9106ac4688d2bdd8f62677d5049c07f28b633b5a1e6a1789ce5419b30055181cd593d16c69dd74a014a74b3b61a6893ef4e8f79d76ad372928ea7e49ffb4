{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{2849:function(t,n,e){\"use strict\";function i(t,n){var e,i;return\"boolean\"===typeof(null===n||void 0===n?void 0:n.enabled)?n.enabled:null===(i=null===(e=null===t||void 0===t?void 0:t.__default)||void 0===e?void 0:e.enabled)||void 0===i||i}e.d(n,\"a\",(function(){return i}))},3248:function(t,n,e){\"use strict\";function i(t){return\"object\"===Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}e.d(n,\"a\",(function(){return i}))},3422:function(t,n,e){\"use strict\";e.r(n),e.d(n,\"LegacyDestination\",(function(){return _})),e.d(n,\"ajsDestinations\",(function(){return k}));var i=e(5),o=e(189),r=e(205),a=e(131),s=e(134),c=e(298),u=e(269),d=e(2849),l=e(536),v=e(539),h=e(349),f=e(233),b=e(537),p=e(261),g=e(305);function j(t){return t.toLowerCase().replace(\".\",\"\").replace(/\\s+/g,\"-\")}function y(t,n){return void 0===n&&(n=!1),n?btoa(t).replace(/=/g,\"\"):void 0}function O(t,n,e,o){return Object(i.b)(this,void 0,void 0,(function(){var r,a,s,c,u,d;return Object(i.d)(this,(function(l){switch(l.label){case 0:r=j(n),a=y(r,o),s=Object(p.b)(),c=\"\".concat(s,\"/integrations/\").concat(null!==a&&void 0!==a?a:r,\"/\").concat(e,\"/\").concat(null!==a&&void 0!==a?a:r,\".dynamic.js.gz\"),l.label=1;case 1:return l.trys.push([1,3,,4]),[4,Object(g.a)(c)];case 2:return l.sent(),function(t,n,e){var o,r;try{var a=(null!==(r=null===(o=null===window||void 0===window?void 0:window.performance)||void 0===o?void 0:o.getEntriesByName(t,\"resource\"))&&void 0!==r?r:[])[0];a&&n.stats.gauge(\"legacy_destination_time\",Math.round(a.duration),Object(i.f)([e],a.duration<100?[\"cached\"]:[],!0))}catch(s){}}(c,t,n),[3,4];case 3:throw u=l.sent(),t.stats.gauge(\"legacy_destination_time\",-1,[\"plugin:\".concat(n),\"failed\"]),u;case 4:return d=window[\"\".concat(r,\"Deps\")],[4,Promise.all(d.map((function(t){return Object(g.a)(s+t+\".gz\")})))];case 5:return l.sent(),window[\"\".concat(r,\"Loader\")](),[2,window[\"\".concat(r,\"Integration\")]]}}))}))}var w=e(3248);function m(t,n){return Object(i.b)(this,void 0,void 0,(function(){var e,o=this;return Object(i.d)(this,(function(s){switch(s.label){case 0:return e=[],Object(r.a)()?[2,n]:[4,Object(v.a)((function(){return n.length>0&&Object(r.b)()}),(function(){return Object(i.b)(o,void 0,void 0,(function(){var o,r;return Object(i.d)(this,(function(i){switch(i.label){case 0:return(o=n.pop())?[4,Object(u.a)(o,t)]:[2];case 1:return r=i.sent(),r instanceof a.a||e.push(o),[2]}}))}))}))];case 1:return s.sent(),e.map((function(t){return n.pushWithBackoff(t)})),[2,n]}}))}))}var _=function(){function t(t,n,e,o,r){void 0===e&&(e={}),this.options={},this.type=\"destination\",this.middleware=[],this._ready=!1,this._initialized=!1,this.flushing=!1,this.name=t,this.version=n,this.settings=Object(i.a)({},e),this.disableAutoISOConversion=o.disableAutoISOConversion||!1,this.integrationSource=r,this.settings.type&&\"browser\"===this.settings.type&&delete this.settings.type,this.options=o,this.buffer=o.disableClientPersistence?new h.b(4,[]):new f.a(4,\"dest-\".concat(t)),this.scheduleFlush()}return t.prototype.isLoaded=function(){return this._ready},t.prototype.ready=function(){var t;return null!==(t=this.onReady)&&void 0!==t?t:Promise.resolve()},t.prototype.load=function(t,n){var e;return Object(i.b)(this,void 0,void 0,(function(){var o,r,a=this;return Object(i.d)(this,(function(i){switch(i.label){case 0:return this._ready||void 0!==this.onReady?[2]:null===(e=this.integrationSource)||void 0===e?[3,1]:(r=e,[3,3]);case 1:return[4,O(t,this.name,this.version,this.options.obfuscate)];case 2:r=i.sent(),i.label=3;case 3:o=r,this.integration=function(t,n,e){var i;\"Integration\"in t?(t({user:function(){return e.user()},addIntegration:function(){}}),i=t.Integration):i=t;var o=new i(n);return o.analytics=e,o}(o,this.settings,n),this.onReady=new Promise((function(t){a.integration.once(\"ready\",(function(){a._ready=!0,t(!0)}))})),this.onInitialize=new Promise((function(t){a.integration.on(\"initialize\",(function(){a._initialized=!0,t(!0)}))}));try{t.stats.increment(\"analytics_js.integration.invoke\",1,[\"method:initialize\",\"integration_name:\".concat(this.name)]),this.integration.initialize()}catch(s){throw t.stats.increment(\"analytics_js.integration.invoke.error\",1,[\"method:initialize\",\"integration_name:\".concat(this.name)]),s}return[2]}}))}))},t.prototype.unload=function(t,n){return function(t,n,e){return Object(i.b)(this,void 0,void 0,(function(){var o,r,a,s;return Object(i.d)(this,(function(i){return o=Object(p.b)(),r=j(t),a=y(t,e),s=\"\".concat(o,\"/integrations/\").concat(null!==a&&void 0!==a?a:r,\"/\").concat(n,\"/\").concat(null!==a&&void 0!==a?a:r,\".dynamic.js.gz\"),[2,Object(g.b)(s)]}))}))}(this.name,this.version,this.options.obfuscate)},t.prototype.addMiddleware=function(){for(var t,n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];this.middleware=(t=this.middleware).concat.apply(t,n)},t.prototype.shouldBuffer=function(t){return\"page\"!==t.event.type&&(Object(r.a)()||!1===this._ready||!1===this._initialized)},t.prototype.send=function(t,n,e){var o,r;return Object(i.b)(this,void 0,void 0,(function(){var a,c,u,l,v,h;return Object(i.d)(this,(function(f){switch(f.label){case 0:if(this.shouldBuffer(t))return this.buffer.push(t),this.scheduleFlush(),[2,t];if(a=null===(r=null===(o=this.options)||void 0===o?void 0:o.plan)||void 0===r?void 0:r.track,c=t.event.event,a&&c&&\"june.so\"!==this.name){if(u=a[c],!Object(d.a)(a,u))return t.updateEvent(\"integrations\",Object(i.a)(Object(i.a)({},t.event.integrations),{All:!1,\"june.so\":!0})),t.cancel(new s.a({retry:!1,reason:\"Event \".concat(c,\" disabled for integration \").concat(this.name,\" in tracking plan\"),type:\"Dropped by plan\"})),[2,t];if(t.updateEvent(\"integrations\",Object(i.a)(Object(i.a)({},t.event.integrations),null===u||void 0===u?void 0:u.integrations)),(null===u||void 0===u?void 0:u.enabled)&&!1===(null===u||void 0===u?void 0:u.integrations[this.name]))return t.cancel(new s.a({retry:!1,reason:\"Event \".concat(c,\" disabled for integration \").concat(this.name,\" in tracking plan\"),type:\"Dropped by plan\"})),[2,t]}return[4,Object(b.applyDestinationMiddleware)(this.name,t.event,this.middleware)];case 1:if(null===(l=f.sent()))return[2,t];v=new n(l,{traverse:!this.disableAutoISOConversion}),t.stats.increment(\"analytics_js.integration.invoke\",1,[\"method:\".concat(e),\"integration_name:\".concat(this.name)]),f.label=2;case 2:return f.trys.push([2,5,,6]),this.integration?[4,this.integration.invoke.call(this.integration,e,v)]:[3,4];case 3:f.sent(),f.label=4;case 4:return[3,6];case 5:throw h=f.sent(),t.stats.increment(\"analytics_js.integration.invoke.error\",1,[\"method:\".concat(e),\"integration_name:\".concat(this.name)]),h;case 6:return[2,t]}}))}))},t.prototype.track=function(t){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(n){return[2,this.send(t,o.Track,\"track\")]}))}))},t.prototype.page=function(t){var n;return Object(i.b)(this,void 0,void 0,(function(){var e=this;return Object(i.d)(this,(function(i){return(null===(n=this.integration)||void 0===n?void 0:n._assumesPageview)&&!this._initialized&&this.integration.initialize(),[2,this.onInitialize.then((function(){return e.send(t,o.Page,\"page\")}))]}))}))},t.prototype.identify=function(t){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(n){return[2,this.send(t,o.Identify,\"identify\")]}))}))},t.prototype.alias=function(t){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(n){return[2,this.send(t,o.Alias,\"alias\")]}))}))},t.prototype.group=function(t){return Object(i.b)(this,void 0,void 0,(function(){return Object(i.d)(this,(function(n){return[2,this.send(t,o.Group,\"group\")]}))}))},t.prototype.scheduleFlush=function(){var t=this;this.flushing||setTimeout((function(){return Object(i.b)(t,void 0,void 0,(function(){var t;return Object(i.d)(this,(function(n){switch(n.label){case 0:return this.flushing=!0,t=this,[4,m(this,this.buffer)];case 1:return t.buffer=n.sent(),this.flushing=!1,this.buffer.todo>0&&this.scheduleFlush(),[2]}}))}))}),5e3*Math.random())},t}();function k(t,n,e,o,r){var a,s;if(void 0===n&&(n={}),void 0===e&&(e={}),Object(c.b)())return[];t.plan&&((e=null!==e&&void 0!==e?e:{}).plan=t.plan);var u=null!==(s=null===(a=t.middlewareSettings)||void 0===a?void 0:a.routingRules)&&void 0!==s?s:[],d=t.integrations,v=e.integrations,h=Object(l.a)(t,null!==e&&void 0!==e?e:{}),f=null===r||void 0===r?void 0:r.reduce((function(t,n){var e;return Object(i.a)(Object(i.a)({},t),((e={})[function(t){return(\"Integration\"in t?t.Integration:t).prototype.name}(n)]=n,e))}),{}),b=new Set(Object(i.f)(Object(i.f)([],Object.keys(d).filter((function(t){return function(t,n){var e,i=n.type,o=n.bundlingStatus,r=n.versionSettings,a=\"unbundled\"!==o&&(\"browser\"===i||(null===(e=null===r||void 0===r?void 0:r.componentTypes)||void 0===e?void 0:e.includes(\"browser\")));return!t.startsWith(\"Segment\")&&\"Iterable\"!==t&&a}(t,d[t])})),!0),Object.keys(f||{}).filter((function(t){return Object(w.a)(d[t])||Object(w.a)(null===v||void 0===v?void 0:v[t])})),!0));return Array.from(b).filter((function(t){return!function(t,n){var e=!1===n.All&&void 0===n[t];return!1===n[t]||e}(t,n)})).map((function(t){var n=function(t){var n,e,i,o;return null!==(o=null!==(e=null===(n=null===t||void 0===t?void 0:t.versionSettings)||void 0===n?void 0:n.override)&&void 0!==e?e:null===(i=null===t||void 0===t?void 0:t.versionSettings)||void 0===i?void 0:i.version)&&void 0!==o?o:\"latest\"}(d[t]),i=new _(t,n,h[t],e,null===f||void 0===f?void 0:f[t]);return u.filter((function(n){return n.destinationName===t})).length>0&&o&&i.addMiddleware(o),i}))}}}]);","name":"js/ajs-destination-932d395355cafbfe0dc8.chunk.js","map":{"version":3,"names":["window","push","module","__webpack_exports__","__webpack_require__","isPlanEventEnabled","plan","planEvent","_a","_b","enabled","__default","d","isPlainObject","obj","Object","prototype","toString","call","slice","toLowerCase","r","ajs_destination_LegacyDestination","ajsDestinations","tslib_es6","dist","connection","context","esm_context","environment","delivery","is_plan_event_enabled","merged_options","p_while","priority_queue","persisted","middleware","parse_cdn","load_script","normalizeName","name","replace","obfuscatePathName","pathName","obfuscate","btoa","undefined","loadIntegration","ctx","version","this","obfuscatedPathName","path","fullPath","err_1","deps","label","concat","trys","sent","metric","performance","getEntriesByName","stats","gauge","Math","round","duration","_","recordLoadMetrics","Promise","all","map","dep","helpers","flushQueue","xt","queue","failedQueue","_this","length","result","pop","failed","pushWithBackoff","LegacyDestination","settings","options","integrationSource","type","_ready","_initialized","flushing","disableAutoISOConversion","buffer","disableClientPersistence","scheduleFlush","isLoaded","ready","onReady","resolve","load","analyticsInstance","_c","integration","integrationSettings","integrationCtr","user","addIntegration","Integration","analytics","buildIntegration","once","onInitialize","on","increment","initialize","error","unload","_ctx","_analyticsInstance","unloadIntegration","addMiddleware","fn","_i","arguments","apply","shouldBuffer","event","send","clz","eventType","ev","afterMiddleware","track","updateEvent","integrations","All","cancel","retry","reason","traverse","invoke","page","_assumesPageview","then","identify","alias","group","setTimeout","todo","random","globalIntegrations","routingMiddleware","legacyIntegrationSources","routingRules","middlewareSettings","remoteIntegrationsConfig","localIntegrationsConfig","integrationOptions","adhocIntegrationSources","reduce","acc","resolveIntegrationNameFromSource","installableIntegrations","Set","keys","filter","bundlingStatus","versionSettings","deviceMode","componentTypes","includes","startsWith","isInstallableIntegration","Array","from","integrationName","allDisableAndNotDefined","isDisabledIntegration","_d","override","resolveVersion","destination","rule","destinationName"],"sources":["js/ajs-destination-932d395355cafbfe0dc8.chunk.js"],"mappings":"CAACA,OAAqB,aAAIA,OAAqB,cAAK,IAAIC,KAAK,CAAC,CAAC,IAAI,CAE7D,KACA,SAAUC,EAAQC,EAAqBC,GAE7C,aAQA,SAASC,EAAmBC,EAAMC,GAChC,IAAIC,EAAIC,EAGR,MAAyF,mBAA/D,OAAdF,QAAoC,IAAdA,OAAuB,EAASA,EAAUG,SACnEH,EAAUG,QAIiH,QAA5HD,EAA2E,QAArED,EAAc,OAATF,QAA0B,IAATA,OAAkB,EAASA,EAAKK,iBAA8B,IAAPH,OAAgB,EAASA,EAAGE,eAA4B,IAAPD,GAAgBA,EAhB/HL,EAAoBQ,EAAET,EAAqB,KAAK,WAAa,OAAOE,MAqB7F,KACA,SAAUH,EAAQC,EAAqBC,GAE7C,aAeA,SAASS,EAAcC,GACrB,MAA0E,WAAnEC,OAAOC,UAAUC,SAASC,KAAKJ,GAAKK,MAAM,GAAI,GAAGC,cAZ3BhB,EAAoBQ,EAAET,EAAqB,KAAK,WAAa,OAAOU,MAuB7F,KACA,SAAUX,EAAQC,EAAqBC,GAE7C,aAEAA,EAAoBiB,EAAElB,GAGtBC,EAAoBQ,EAAET,EAAqB,qBAAqB,WAAa,OAAqBmB,KAClGlB,EAAoBQ,EAAET,EAAqB,mBAAmB,WAAa,OAAqBoB,KAGhG,IAAIC,EAAYpB,EAAoB,GAGhCqB,EAAOrB,EAAoB,KAG3BsB,EAAatB,EAAoB,KAGjCuB,EAAUvB,EAAoB,KAG9BwB,EAAcxB,EAAoB,KAGlCyB,EAAczB,EAAoB,KAGlC0B,EAAW1B,EAAoB,KAG/B2B,EAAwB3B,EAAoB,MAG5C4B,EAAiB5B,EAAoB,KAGrC6B,EAAU7B,EAAoB,KAG9B8B,EAAiB9B,EAAoB,KAGrC+B,EAAY/B,EAAoB,KAGhCgC,EAAahC,EAAoB,KAGjCiC,EAAYjC,EAAoB,KAGhCkC,EAAclC,EAAoB,KAOtC,SAASmC,EAAcC,GACrB,OAAOA,EAAKpB,cAAcqB,QAAQ,IAAK,IAAIA,QAAQ,OAAQ,KAG7D,SAASC,EAAkBC,EAAUC,GAKnC,YAJkB,IAAdA,IACFA,GAAY,GAGPA,EAAYC,KAAKF,GAAUF,QAAQ,KAAM,SAAMK,EAsCxD,SAASC,EAAgBC,EAAKR,EAAMS,EAASL,GAC3C,OAAO7B,OAAOS,EAA6B,EAApCT,CAAuCmC,UAAM,OAAQ,GAAQ,WAClE,IAAIP,EAAUQ,EAAoBC,EAAMC,EAAUC,EAAOC,EACzD,OAAOxC,OAAOS,EAA+B,EAAtCT,CAAyCmC,MAAM,SAAU1C,GAC9D,OAAQA,EAAGgD,OACT,KAAK,EACHb,EAAWJ,EAAcC,GACzBW,EAAqBT,EAAkBC,EAAUC,GACjDQ,EAAOrC,OAAOsB,EAA0C,EAAjDtB,GACPsC,EAAW,GAAGI,OAAOL,EAAM,kBAAkBK,OAA8B,OAAvBN,QAAsD,IAAvBA,EAAgCA,EAAqBR,EAAU,KAAKc,OAAOR,EAAS,KAAKQ,OAA8B,OAAvBN,QAAsD,IAAvBA,EAAgCA,EAAqBR,EAAU,kBACjRnC,EAAGgD,MAAQ,EAEb,KAAK,EAGH,OAFAhD,EAAGkD,KAAKzD,KAAK,CAAC,EAAG,EAAE,CAAE,IAEd,CAAC,EAENc,OAAOuB,EAAgC,EAAvCvB,CAA0CsC,IAE9C,KAAK,EAIH,OAHA7C,EAAGmD,OAnDb,SAA2BN,EAAUL,EAAKR,GACxC,IAAIhC,EAAIC,EAER,IACE,IAAImD,GAA8K,QAAnKnD,EAAmF,QAA7ED,EAAgB,OAAXR,aAA8B,IAAXA,YAAoB,EAASA,OAAO6D,mBAAgC,IAAPrD,OAAgB,EAASA,EAAGsD,iBAAiBT,EAAU,mBAAgC,IAAP5C,EAAgBA,EAAK,IAAI,GAEnNmD,GAAUZ,EAAIe,MAAMC,MAAM,0BAA2BC,KAAKC,MAAMN,EAAOO,UAAWpD,OAAOS,EAAiC,EAAxCT,CAA2C,CAACyB,GAAOoB,EAAOO,SAAW,IAAM,CAAC,UAAY,IAAI,IAC9K,MAAOC,KA8CDC,CAAkBhB,EAAUL,EAAKR,GAC1B,CAAC,EAEN,GAEJ,KAAK,EAGH,MAFAc,EAAQ9C,EAAGmD,OACXX,EAAIe,MAAMC,MAAM,2BAA4B,EAAG,CAAC,UAAUP,OAAOjB,GAAO,WAClEc,EAER,KAAK,EAEH,OADAC,EAAOvD,OAAO,GAAGyD,OAAOd,EAAU,SAC3B,CAAC,EAEN2B,QAAQC,IAAIhB,EAAKiB,KAAI,SAAUC,GAC/B,OAAO1D,OAAOuB,EAAgC,EAAvCvB,CAA0CqC,EAAOqB,EAAM,YAIlE,KAAK,EAKH,OAJAjE,EAAGmD,OAGH3D,OAAO,GAAGyD,OAAOd,EAAU,aACpB,CAAC,EAEN3C,OACF,GAAGyD,OAAOd,EAAU,wBAyB9B,IAAI+B,EAAUtE,EAAoB,MAsClC,SAASuE,EAAWC,EAAIC,GACtB,OAAO9D,OAAOS,EAA6B,EAApCT,CAAuCmC,UAAM,OAAQ,GAAQ,WAClE,IAAI4B,EAEAC,EAAQ7B,KAEZ,OAAOnC,OAAOS,EAA+B,EAAtCT,CAAyCmC,MAAM,SAAU1C,GAC9D,OAAQA,EAAGgD,OACT,KAAK,EAGH,OAFAsB,EAAc,GAEV/D,OAAOW,EAA8B,EAArCX,GACK,CAAC,EAEN8D,GAGG,CAAC,EAEN9D,OAAOkB,EAAwB,EAA/BlB,EAAkC,WAClC,OAAO8D,EAAMG,OAAS,GAAKjE,OAAOW,EAA6B,EAApCX,MAC1B,WACD,OAAOA,OAAOS,EAA6B,EAApCT,CAAuCgE,OAAO,OAAQ,GAAQ,WACnE,IAAI/B,EAAKiC,EACT,OAAOlE,OAAOS,EAA+B,EAAtCT,CAAyCmC,MAAM,SAAU1C,GAC9D,OAAQA,EAAGgD,OACT,KAAK,EAGH,OAFAR,EAAM6B,EAAMK,OAQL,CAAC,EAENnE,OAAOe,EAA0B,EAAjCf,CAAoCiC,EAAK4B,IAPlC,CAAC,GASZ,KAAK,EAQH,OAPAK,EAASzE,EAAGmD,OACFsB,aAAkBtD,EAAyB,GAGnDmD,EAAY7E,KAAK+C,GAGZ,CAAC,cASpB,KAAK,EAOH,OANAxC,EAAGmD,OAGHmB,EAAYN,KAAI,SAAUW,GACxB,OAAON,EAAMO,gBAAgBD,MAExB,CAAC,EAENN,UAMZ,IAAIvD,EAEJ,WACE,SAAS+D,EAAkB7C,EAAMS,EAASqC,EAAUC,EAASC,QAC1C,IAAbF,IACFA,EAAW,IAGbpC,KAAKqC,QAAU,GACfrC,KAAKuC,KAAO,cACZvC,KAAKd,WAAa,GAClBc,KAAKwC,QAAS,EACdxC,KAAKyC,cAAe,EACpBzC,KAAK0C,UAAW,EAChB1C,KAAKV,KAAOA,EACZU,KAAKD,QAAUA,EACfC,KAAKoC,SAAWvE,OAAOS,EAA4B,EAAnCT,CAAsC,GAAIuE,GAC1DpC,KAAK2C,yBAA2BN,EAAQM,2BAA4B,EACpE3C,KAAKsC,kBAAoBA,EAGrBtC,KAAKoC,SAAe,MAA+B,YAA1BpC,KAAKoC,SAAe,aACxCpC,KAAKoC,SAAe,KAG7BpC,KAAKqC,QAAUA,EACfrC,KAAK4C,OAASP,EAAQQ,yBAA2B,IAAI7D,EAAsC,EAAE,EAAG,IAAM,IAAIC,EAA0C,EAAE,EAAG,QAAQsB,OAAOjB,IACxKU,KAAK8C,gBAmTP,OAhTAX,EAAkBrE,UAAUiF,SAAW,WACrC,OAAO/C,KAAKwC,QAGdL,EAAkBrE,UAAUkF,MAAQ,WAClC,IAAI1F,EAEJ,OAA+B,QAAvBA,EAAK0C,KAAKiD,eAA4B,IAAP3F,EAAgBA,EAAK8D,QAAQ8B,WAGtEf,EAAkBrE,UAAUqF,KAAO,SAAUrD,EAAKsD,GAChD,IAAI9F,EAEJ,OAAOO,OAAOS,EAA6B,EAApCT,CAAuCmC,UAAM,OAAQ,GAAQ,WAClE,IAAIsC,EAAmB/E,EAEnBsE,EAAQ7B,KAEZ,OAAOnC,OAAOS,EAA+B,EAAtCT,CAAyCmC,MAAM,SAAUqD,GAC9D,OAAQA,EAAG/C,OACT,KAAK,EACH,OAAIN,KAAKwC,aAA2B5C,IAAjBI,KAAKiD,QACf,CAAC,GAK8B,QAAjC3F,EAAK0C,KAAKsC,yBAAsC,IAAPhF,EAAuB,CAAC,EAEtE,IACFC,EAAKD,EACE,CAAC,EAEN,IAEJ,KAAK,EACH,MAAO,CAAC,EAENuC,EAAgBC,EAAKE,KAAKV,KAAMU,KAAKD,QAASC,KAAKqC,QAAQ3C,YAE/D,KAAK,EACHnC,EAAK8F,EAAG5C,OACR4C,EAAG/C,MAAQ,EAEb,KAAK,EACHgC,EAAoB/E,EACpByC,KAAKsD,YAvRjB,SAA0BhB,EAAmBiB,EAAqBH,GAChE,IAAII,EAEA,gBAAiBlB,GAOnBA,EANoB,CAClBmB,KAAM,WACJ,OAAOL,EAAkBK,QAE3BC,eAAgB,eAGlBF,EAAiBlB,EAAkBqB,aAEnCH,EAAiBlB,EAGnB,IAAIgB,EAAc,IAAIE,EAAeD,GAErC,OADAD,EAAYM,UAAYR,EACjBE,EAqQsBO,CAAiBvB,EAAmBtC,KAAKoC,SAAUgB,GACtEpD,KAAKiD,QAAU,IAAI7B,SAAQ,SAAU8B,GAMnCrB,EAAMyB,YAAYQ,KAAK,SALP,WACdjC,EAAMW,QAAS,EACfU,GAAQ,SAKZlD,KAAK+D,aAAe,IAAI3C,SAAQ,SAAU8B,GAMxCrB,EAAMyB,YAAYU,GAAG,cALR,WACXnC,EAAMY,cAAe,EACrBS,GAAQ,SAMZ,IACEpD,EAAIe,MAAMoD,UAAU,kCAAmC,EAAG,CAAC,oBAAqB,oBAAoB1D,OAAOP,KAAKV,QAChHU,KAAKsD,YAAYY,aACjB,MAAOC,GAEP,MADArE,EAAIe,MAAMoD,UAAU,wCAAyC,EAAG,CAAC,oBAAqB,oBAAoB1D,OAAOP,KAAKV,QAChH6E,EAGR,MAAO,CAAC,WAQlBhC,EAAkBrE,UAAUsG,OAAS,SAAUC,EAAMC,GACnD,OAhPJ,SAA2BhF,EAAMS,EAASL,GACxC,OAAO7B,OAAOS,EAA6B,EAApCT,CAAuCmC,UAAM,OAAQ,GAAQ,WAClE,IAAIE,EAAMT,EAAUQ,EAAoBE,EACxC,OAAOtC,OAAOS,EAA+B,EAAtCT,CAAyCmC,MAAM,SAAU1C,GAK9D,OAJA4C,EAAOrC,OAAOsB,EAA0C,EAAjDtB,GACP4B,EAAWJ,EAAcC,GACzBW,EAAqBT,EAAkBF,EAAMI,GAC7CS,EAAW,GAAGI,OAAOL,EAAM,kBAAkBK,OAA8B,OAAvBN,QAAsD,IAAvBA,EAAgCA,EAAqBR,EAAU,KAAKc,OAAOR,EAAS,KAAKQ,OAA8B,OAAvBN,QAAsD,IAAvBA,EAAgCA,EAAqBR,EAAU,kBAC1Q,CAAC,EAEN5B,OAAOuB,EAAkC,EAAzCvB,CAA4CsC,UAsOzCoE,CAAkBvE,KAAKV,KAAMU,KAAKD,QAASC,KAAKqC,QAAQ3C,YAGjEyC,EAAkBrE,UAAU0G,cAAgB,WAK1C,IAJA,IAAIlH,EAEAmH,EAAK,GAEAC,EAAK,EAAGA,EAAKC,UAAU7C,OAAQ4C,IACtCD,EAAGC,GAAMC,UAAUD,GAGrB1E,KAAKd,YAAc5B,EAAK0C,KAAKd,YAAYqB,OAAOqE,MAAMtH,EAAImH,IAG5DtC,EAAkBrE,UAAU+G,aAAe,SAAU/E,GACnD,MACqB,SAAnBA,EAAIgF,MAAMvC,OAAoB1E,OAAOW,EAA8B,EAArCX,KAA6D,IAAhBmC,KAAKwC,SAA0C,IAAtBxC,KAAKyC,eAI7GN,EAAkBrE,UAAUiH,KAAO,SAAUjF,EAAKkF,EAAKC,GACrD,IAAI3H,EAAIC,EAER,OAAOM,OAAOS,EAA6B,EAApCT,CAAuCmC,UAAM,OAAQ,GAAQ,WAClE,IAAI5C,EAAM8H,EAAI7H,EAAW8H,EAAiBL,EAAO1E,EACjD,OAAOvC,OAAOS,EAA+B,EAAtCT,CAAyCmC,MAAM,SAAUqD,GAC9D,OAAQA,EAAG/C,OACT,KAAK,EACH,GAAIN,KAAK6E,aAAa/E,GAGpB,OAFAE,KAAK4C,OAAO7F,KAAK+C,GACjBE,KAAK8C,gBACE,CAAC,EAENhD,GAMJ,GAHA1C,EAAmF,QAA3EG,EAA6B,QAAvBD,EAAK0C,KAAKqC,eAA4B,IAAP/E,OAAgB,EAASA,EAAGF,YAAyB,IAAPG,OAAgB,EAASA,EAAG6H,MACvHF,EAAKpF,EAAIgF,MAAMA,MAEX1H,GAAQ8H,GAAoB,YAAdlF,KAAKV,KAAoB,CAGzC,GAFAjC,EAAYD,EAAK8H,IAEZrH,OAAOgB,EAAkD,EAAzDhB,CAA4DT,EAAMC,GAUrE,OATAyC,EAAIuF,YAAY,eAAgBxH,OAAOS,EAA4B,EAAnCT,CAAsCA,OAAOS,EAA4B,EAAnCT,CAAsC,GAAIiC,EAAIgF,MAAMQ,cAAe,CACvIC,KAAK,EACL,WAAW,KAEbzF,EAAI0F,OAAO,IAAI9G,EAAwC,EAAE,CACvD+G,OAAO,EACPC,OAAQ,SAASnF,OAAO2E,EAAI,8BAA8B3E,OAAOP,KAAKV,KAAM,qBAC5EiD,KAAM,qBAED,CAAC,EAENzC,GAKJ,GAHEA,EAAIuF,YAAY,eAAgBxH,OAAOS,EAA4B,EAAnCT,CAAsCA,OAAOS,EAA4B,EAAnCT,CAAsC,GAAIiC,EAAIgF,MAAMQ,cAA6B,OAAdjI,QAAoC,IAAdA,OAAuB,EAASA,EAAUiI,gBAGxL,OAAdjI,QAAoC,IAAdA,OAAuB,EAASA,EAAUG,WAA0G,KAA/E,OAAdH,QAAoC,IAAdA,OAAuB,EAASA,EAAUiI,aAAatF,KAAKV,OAMlK,OALAQ,EAAI0F,OAAO,IAAI9G,EAAwC,EAAE,CACvD+G,OAAO,EACPC,OAAQ,SAASnF,OAAO2E,EAAI,8BAA8B3E,OAAOP,KAAKV,KAAM,qBAC5EiD,KAAM,qBAED,CAAC,EAENzC,GAIN,MAAO,CAAC,EAENjC,OAAOqB,EAAuC,2BAA9CrB,CAAiDmC,KAAKV,KAAMQ,EAAIgF,MAAO9E,KAAKd,aAEhF,KAAK,EAGH,GAAwB,QAFxBiG,EAAkB9B,EAAG5C,QAGnB,MAAO,CAAC,EAENX,GAGJgF,EAAQ,IAAIE,EAAIG,EAAiB,CAC/BQ,UAAW3F,KAAK2C,2BAElB7C,EAAIe,MAAMoD,UAAU,kCAAmC,EAAG,CAAC,UAAU1D,OAAO0E,GAAY,oBAAoB1E,OAAOP,KAAKV,QACxH+D,EAAG/C,MAAQ,EAEb,KAAK,EAGH,OAFA+C,EAAG7C,KAAKzD,KAAK,CAAC,EAAG,EAAE,CAAE,IAEhBiD,KAAKsD,YAGH,CAAC,EAENtD,KAAKsD,YAAYsC,OAAO5H,KAAKgC,KAAKsD,YAAa2B,EAAWH,IAL9B,CAAC,EAE7B,GAKJ,KAAK,EACHzB,EAAG5C,OAEH4C,EAAG/C,MAAQ,EAEb,KAAK,EACH,MAAO,CAAC,EAEN,GAEJ,KAAK,EAGH,MAFAF,EAAQiD,EAAG5C,OACXX,EAAIe,MAAMoD,UAAU,wCAAyC,EAAG,CAAC,UAAU1D,OAAO0E,GAAY,oBAAoB1E,OAAOP,KAAKV,QACxHc,EAER,KAAK,EACH,MAAO,CAAC,EAENN,WAMZqC,EAAkBrE,UAAUsH,MAAQ,SAAUtF,GAC5C,OAAOjC,OAAOS,EAA6B,EAApCT,CAAuCmC,UAAM,OAAQ,GAAQ,WAClE,OAAOnC,OAAOS,EAA+B,EAAtCT,CAAyCmC,MAAM,SAAU1C,GAC9D,MAAO,CAAC,EAEN0C,KAAK+E,KAAKjF,EAAKvB,EAAY,MAAG,iBAKtC4D,EAAkBrE,UAAU+H,KAAO,SAAU/F,GAC3C,IAAIxC,EAEJ,OAAOO,OAAOS,EAA6B,EAApCT,CAAuCmC,UAAM,OAAQ,GAAQ,WAClE,IAAI6B,EAAQ7B,KAEZ,OAAOnC,OAAOS,EAA+B,EAAtCT,CAAyCmC,MAAM,SAAUzC,GAK9D,OAJiC,QAA3BD,EAAK0C,KAAKsD,mBAAgC,IAAPhG,OAAgB,EAASA,EAAGwI,oBAAsB9F,KAAKyC,cAC9FzC,KAAKsD,YAAYY,aAGZ,CAAC,EAENlE,KAAK+D,aAAagC,MAAK,WACvB,OAAOlE,EAAMkD,KAAKjF,EAAKvB,EAAW,KAAG,mBAM7C4D,EAAkBrE,UAAUkI,SAAW,SAAUlG,GAC/C,OAAOjC,OAAOS,EAA6B,EAApCT,CAAuCmC,UAAM,OAAQ,GAAQ,WAClE,OAAOnC,OAAOS,EAA+B,EAAtCT,CAAyCmC,MAAM,SAAU1C,GAC9D,MAAO,CAAC,EAEN0C,KAAK+E,KAAKjF,EAAKvB,EAAe,SAAG,oBAKzC4D,EAAkBrE,UAAUmI,MAAQ,SAAUnG,GAC5C,OAAOjC,OAAOS,EAA6B,EAApCT,CAAuCmC,UAAM,OAAQ,GAAQ,WAClE,OAAOnC,OAAOS,EAA+B,EAAtCT,CAAyCmC,MAAM,SAAU1C,GAC9D,MAAO,CAAC,EAEN0C,KAAK+E,KAAKjF,EAAKvB,EAAY,MAAG,iBAKtC4D,EAAkBrE,UAAUoI,MAAQ,SAAUpG,GAC5C,OAAOjC,OAAOS,EAA6B,EAApCT,CAAuCmC,UAAM,OAAQ,GAAQ,WAClE,OAAOnC,OAAOS,EAA+B,EAAtCT,CAAyCmC,MAAM,SAAU1C,GAC9D,MAAO,CAAC,EAEN0C,KAAK+E,KAAKjF,EAAKvB,EAAY,MAAG,iBAKtC4D,EAAkBrE,UAAUgF,cAAgB,WAC1C,IAAIjB,EAAQ7B,KAERA,KAAK0C,UAKTyD,YAAW,WACT,OAAOtI,OAAOS,EAA6B,EAApCT,CAAuCgE,OAAO,OAAQ,GAAQ,WACnE,IAAIvE,EAEJ,OAAOO,OAAOS,EAA+B,EAAtCT,CAAyCmC,MAAM,SAAUzC,GAC9D,OAAQA,EAAG+C,OACT,KAAK,EAGH,OAFAN,KAAK0C,UAAW,EAChBpF,EAAK0C,KACE,CAAC,EAENyB,EAAWzB,KAAMA,KAAK4C,SAE1B,KAAK,EAQH,OAPAtF,EAAGsF,OAASrF,EAAGkD,OACfT,KAAK0C,UAAW,EAEZ1C,KAAK4C,OAAOwD,KAAO,GACrBpG,KAAK8C,gBAGA,CAAC,YAMC,IAAhB/B,KAAKsF,WAGHlE,EA5UT,GAgVA,SAAS9D,EAAgB+D,EAAUkE,EAAoBjE,EAASkE,EAAmBC,GACjF,IAAIlJ,EAAIC,EAUR,QAR2B,IAAvB+I,IACFA,EAAqB,SAGP,IAAZjE,IACFA,EAAU,IAGRxE,OAAOc,EAA8B,EAArCd,GACF,MAAO,GAGLuE,EAAShF,QACXiF,EAAsB,OAAZA,QAAgC,IAAZA,EAAqBA,EAAU,IACrDjF,KAAOgF,EAAShF,MAG1B,IAAIqJ,EAAkH,QAAlGlJ,EAA4C,QAAtCD,EAAK8E,EAASsE,0BAAuC,IAAPpJ,OAAgB,EAASA,EAAGmJ,oBAAiC,IAAPlJ,EAAgBA,EAAK,GAC/IoJ,EAA2BvE,EAASkD,aACpCsB,EAA0BvE,EAAQiD,aAElCuB,EAAqBhJ,OAAOiB,EAAsC,EAA7CjB,CAAgDuE,EAAsB,OAAZC,QAAgC,IAAZA,EAAqBA,EAAU,IAClIyE,EAAuD,OAA7BN,QAAkE,IAA7BA,OAAsC,EAASA,EAAyBO,QAAO,SAAUC,EAAK1E,GAC/J,IAAIhF,EAEJ,OAAOO,OAAOS,EAA4B,EAAnCT,CAAsCA,OAAOS,EAA4B,EAAnCT,CAAsC,GAAImJ,KAAO1J,EAAK,IAxkBvG,SAA0CgF,GACxC,OAAQ,gBAAiBA,EAAoBA,EAAkBqB,YAAcrB,GAAmBxE,UAAUwB,KAukBE2H,CAAiC3E,IAAsBA,EAAmBhF,MACnL,IACC4J,EAA0B,IAAIC,IAAItJ,OAAOS,EAAiC,EAAxCT,CAA2CA,OAAOS,EAAiC,EAAxCT,CAA2C,GAAIA,OAAOuJ,KAAKT,GAA0BU,QAAO,SAAU/H,GACrL,OA3d2B,SAAkCA,EAAMiE,GACrE,IAAIjG,EAEAiF,EAAOgB,EAAoBhB,KAC3B+E,EAAiB/D,EAAoB+D,eACrCC,EAAkBhE,EAAoBgE,gBAGtCC,EAAgC,cAAnBF,IAA4C,YAAT/E,IAAmI,QAA3GjF,EAAyB,OAApBiK,QAAgD,IAApBA,OAA6B,EAASA,EAAgBE,sBAAmC,IAAPnK,OAAgB,EAASA,EAAGoK,SAAS,aAIpO,OAAQpI,EAAKqI,WAAW,YAAuB,aAATrI,GAAuBkI,EA+cpDI,CAAyBtI,EAAMqH,EAAyBrH,QAC7D,GAAOzB,OAAOuJ,KAAKN,GAA2B,IAAIO,QAAO,SAAU/H,GACrE,OAAOzB,OAAO2D,EAA+B,EAAtC3D,CAAyC8I,EAAyBrH,KAAUzB,OAAO2D,EAA+B,EAAtC3D,CAAqE,OAA5B+I,QAAgE,IAA5BA,OAAqC,EAASA,EAAwBtH,QACpO,IACJ,OAAOuI,MAAMC,KAAKZ,GAAyBG,QAAO,SAAU/H,GAC1D,OAldwB,SAA+ByI,EAAiBzB,GAC1E,IAAI0B,GAAqD,IAA3B1B,EAAmBf,UAAyD3F,IAAxC0G,EAAmByB,GACrF,OAA+C,IAAxCzB,EAAmByB,IAA8BC,EAgd9CC,CAAsB3I,EAAMgH,MACnChF,KAAI,SAAUhC,GACf,IACIS,EA5eR,SAAwBqC,GACtB,IAAI9E,EAAIC,EAAI8F,EAAI6E,EAEhB,OAAmU,QAA3TA,EAAqJ,QAA/I3K,EAA6F,QAAvFD,EAAkB,OAAb8E,QAAkC,IAAbA,OAAsB,EAASA,EAASmF,uBAAoC,IAAPjK,OAAgB,EAASA,EAAG6K,gBAA6B,IAAP5K,EAAgBA,EAA6F,QAAvF8F,EAAkB,OAAbjB,QAAkC,IAAbA,OAAsB,EAASA,EAASmF,uBAAoC,IAAPlE,OAAgB,EAASA,EAAGtD,eAA4B,IAAPmI,EAAgBA,EAAK,SAyehVE,CADYzB,EAAyBrH,IAE/C+I,EAAc,IAAIjK,EAAkCkB,EAAMS,EAAS8G,EAAmBvH,GAAO+C,EAAqC,OAA5ByE,QAAgE,IAA5BA,OAAqC,EAASA,EAAwBxH,IASpN,OARcmH,EAAaY,QAAO,SAAUiB,GAC1C,OAAOA,EAAKC,kBAAoBjJ,KAGtBwC,OAAS,GAAKyE,GACxB8B,EAAY7D,cAAc+B,GAGrB8B"},"input":"(window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || []).push([[20],{\n\n/***/ 2849:\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return isPlanEventEnabled; });\n/**\n * Determines whether a track event is allowed to be sent based on the\n * user's tracking plan.\n * If the user does not have a tracking plan or the event is allowed based\n * on the tracking plan configuration, returns true.\n */\nfunction isPlanEventEnabled(plan, planEvent) {\n  var _a, _b; // Always prioritize the event's `enabled` status\n\n\n  if (typeof (planEvent === null || planEvent === void 0 ? void 0 : planEvent.enabled) === 'boolean') {\n    return planEvent.enabled;\n  } // Assume absence of a tracking plan means events are enabled\n\n\n  return (_b = (_a = plan === null || plan === void 0 ? void 0 : plan.__default) === null || _a === void 0 ? void 0 : _a.enabled) !== null && _b !== void 0 ? _b : true;\n}\n\n/***/ }),\n\n/***/ 3248:\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n/* unused harmony export isString */\n/* unused harmony export isNumber */\n/* unused harmony export isFunction */\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"a\", function() { return isPlainObject; });\n/* unused harmony export hasUser */\nfunction isString(obj) {\n  return typeof obj === 'string';\n}\nfunction isNumber(obj) {\n  return typeof obj === 'number';\n}\nfunction isFunction(obj) {\n  return typeof obj === 'function';\n}\nfunction isPlainObject(obj) {\n  return Object.prototype.toString.call(obj).slice(8, -1).toLowerCase() === 'object';\n}\nfunction hasUser(event) {\n  var _a, _b, _c;\n\n  var id = (_c = (_b = (_a = event.userId) !== null && _a !== void 0 ? _a : event.anonymousId) !== null && _b !== void 0 ? _b : event.groupId) !== null && _c !== void 0 ? _c : event.previousId;\n  return isString(id);\n}\n\n/***/ }),\n\n/***/ 3422:\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n// ESM COMPAT FLAG\n__webpack_require__.r(__webpack_exports__);\n\n// EXPORTS\n__webpack_require__.d(__webpack_exports__, \"LegacyDestination\", function() { return /* binding */ ajs_destination_LegacyDestination; });\n__webpack_require__.d(__webpack_exports__, \"ajsDestinations\", function() { return /* binding */ ajsDestinations; });\n\n// EXTERNAL MODULE: ./node_modules/@june-so/analytics-next/node_modules/tslib/tslib.es6.js\nvar tslib_es6 = __webpack_require__(5);\n\n// EXTERNAL MODULE: ./node_modules/@segment/facade/dist/index.js\nvar dist = __webpack_require__(189);\n\n// EXTERNAL MODULE: ./node_modules/@june-so/analytics-next/dist/pkg/core/connection/index.js\nvar connection = __webpack_require__(205);\n\n// EXTERNAL MODULE: ./node_modules/@june-so/analytics-next/dist/pkg/core/context/index.js\nvar context = __webpack_require__(131);\n\n// EXTERNAL MODULE: ./node_modules/@segment/analytics-core/dist/esm/context/index.js + 1 modules\nvar esm_context = __webpack_require__(134);\n\n// EXTERNAL MODULE: ./node_modules/@june-so/analytics-next/dist/pkg/core/environment/index.js\nvar environment = __webpack_require__(298);\n\n// EXTERNAL MODULE: ./node_modules/@segment/analytics-core/dist/esm/queue/delivery.js\nvar delivery = __webpack_require__(269);\n\n// EXTERNAL MODULE: ./node_modules/@june-so/analytics-next/dist/pkg/lib/is-plan-event-enabled.js\nvar is_plan_event_enabled = __webpack_require__(2849);\n\n// EXTERNAL MODULE: ./node_modules/@june-so/analytics-next/dist/pkg/lib/merged-options.js\nvar merged_options = __webpack_require__(536);\n\n// EXTERNAL MODULE: ./node_modules/@june-so/analytics-next/dist/pkg/lib/p-while.js\nvar p_while = __webpack_require__(539);\n\n// EXTERNAL MODULE: ./node_modules/@segment/analytics-core/dist/esm/priority-queue/index.js + 1 modules\nvar priority_queue = __webpack_require__(349);\n\n// EXTERNAL MODULE: ./node_modules/@june-so/analytics-next/dist/pkg/lib/priority-queue/persisted.js\nvar persisted = __webpack_require__(233);\n\n// EXTERNAL MODULE: ./node_modules/@june-so/analytics-next/dist/pkg/plugins/middleware/index.js\nvar middleware = __webpack_require__(537);\n\n// EXTERNAL MODULE: ./node_modules/@june-so/analytics-next/dist/pkg/lib/parse-cdn.js + 1 modules\nvar parse_cdn = __webpack_require__(261);\n\n// EXTERNAL MODULE: ./node_modules/@june-so/analytics-next/dist/pkg/lib/load-script.js\nvar load_script = __webpack_require__(305);\n\n// CONCATENATED MODULE: ./node_modules/@june-so/analytics-next/dist/pkg/plugins/ajs-destination/loader.js\n\n\n\n\nfunction normalizeName(name) {\n  return name.toLowerCase().replace('.', '').replace(/\\s+/g, '-');\n}\n\nfunction obfuscatePathName(pathName, obfuscate) {\n  if (obfuscate === void 0) {\n    obfuscate = false;\n  }\n\n  return obfuscate ? btoa(pathName).replace(/=/g, '') : undefined;\n}\n\nfunction resolveIntegrationNameFromSource(integrationSource) {\n  return ('Integration' in integrationSource ? integrationSource.Integration : integrationSource).prototype.name;\n}\n\nfunction recordLoadMetrics(fullPath, ctx, name) {\n  var _a, _b;\n\n  try {\n    var metric = ((_b = (_a = window === null || window === void 0 ? void 0 : window.performance) === null || _a === void 0 ? void 0 : _a.getEntriesByName(fullPath, 'resource')) !== null && _b !== void 0 ? _b : [])[0]; // we assume everything that took under 100ms is cached\n\n    metric && ctx.stats.gauge('legacy_destination_time', Math.round(metric.duration), Object(tslib_es6[\"f\" /* __spreadArray */])([name], metric.duration < 100 ? ['cached'] : [], true));\n  } catch (_) {// not available\n  }\n}\n\nfunction buildIntegration(integrationSource, integrationSettings, analyticsInstance) {\n  var integrationCtr; // GA and Appcues use a different interface to instantiating integrations\n\n  if ('Integration' in integrationSource) {\n    var analyticsStub = {\n      user: function user() {\n        return analyticsInstance.user();\n      },\n      addIntegration: function addIntegration() {}\n    };\n    integrationSource(analyticsStub);\n    integrationCtr = integrationSource.Integration;\n  } else {\n    integrationCtr = integrationSource;\n  }\n\n  var integration = new integrationCtr(integrationSettings);\n  integration.analytics = analyticsInstance;\n  return integration;\n}\nfunction loadIntegration(ctx, name, version, obfuscate) {\n  return Object(tslib_es6[\"b\" /* __awaiter */])(this, void 0, void 0, function () {\n    var pathName, obfuscatedPathName, path, fullPath, err_1, deps;\n    return Object(tslib_es6[\"d\" /* __generator */])(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          pathName = normalizeName(name);\n          obfuscatedPathName = obfuscatePathName(pathName, obfuscate);\n          path = Object(parse_cdn[\"b\" /* getNextIntegrationsURL */])();\n          fullPath = \"\".concat(path, \"/integrations/\").concat(obfuscatedPathName !== null && obfuscatedPathName !== void 0 ? obfuscatedPathName : pathName, \"/\").concat(version, \"/\").concat(obfuscatedPathName !== null && obfuscatedPathName !== void 0 ? obfuscatedPathName : pathName, \".dynamic.js.gz\");\n          _a.label = 1;\n\n        case 1:\n          _a.trys.push([1, 3,, 4]);\n\n          return [4\n          /*yield*/\n          , Object(load_script[\"a\" /* loadScript */])(fullPath)];\n\n        case 2:\n          _a.sent();\n\n          recordLoadMetrics(fullPath, ctx, name);\n          return [3\n          /*break*/\n          , 4];\n\n        case 3:\n          err_1 = _a.sent();\n          ctx.stats.gauge('legacy_destination_time', -1, [\"plugin:\".concat(name), \"failed\"]);\n          throw err_1;\n\n        case 4:\n          deps = window[\"\".concat(pathName, \"Deps\")];\n          return [4\n          /*yield*/\n          , Promise.all(deps.map(function (dep) {\n            return Object(load_script[\"a\" /* loadScript */])(path + dep + '.gz');\n          })) // @ts-ignore\n          ];\n\n        case 5:\n          _a.sent(); // @ts-ignore\n\n\n          window[\"\".concat(pathName, \"Loader\")]();\n          return [2\n          /*return*/\n          , window[// @ts-ignore\n          \"\".concat(pathName, \"Integration\")]];\n      }\n    });\n  });\n}\nfunction unloadIntegration(name, version, obfuscate) {\n  return Object(tslib_es6[\"b\" /* __awaiter */])(this, void 0, void 0, function () {\n    var path, pathName, obfuscatedPathName, fullPath;\n    return Object(tslib_es6[\"d\" /* __generator */])(this, function (_a) {\n      path = Object(parse_cdn[\"b\" /* getNextIntegrationsURL */])();\n      pathName = normalizeName(name);\n      obfuscatedPathName = obfuscatePathName(name, obfuscate);\n      fullPath = \"\".concat(path, \"/integrations/\").concat(obfuscatedPathName !== null && obfuscatedPathName !== void 0 ? obfuscatedPathName : pathName, \"/\").concat(version, \"/\").concat(obfuscatedPathName !== null && obfuscatedPathName !== void 0 ? obfuscatedPathName : pathName, \".dynamic.js.gz\");\n      return [2\n      /*return*/\n      , Object(load_script[\"b\" /* unloadScript */])(fullPath)];\n    });\n  });\n}\nfunction resolveVersion(settings) {\n  var _a, _b, _c, _d;\n\n  return (_d = (_b = (_a = settings === null || settings === void 0 ? void 0 : settings.versionSettings) === null || _a === void 0 ? void 0 : _a.override) !== null && _b !== void 0 ? _b : (_c = settings === null || settings === void 0 ? void 0 : settings.versionSettings) === null || _c === void 0 ? void 0 : _c.version) !== null && _d !== void 0 ? _d : 'latest';\n}\n// EXTERNAL MODULE: ./node_modules/@segment/analytics-core/dist/esm/validation/helpers.js\nvar helpers = __webpack_require__(3248);\n\n// CONCATENATED MODULE: ./node_modules/@june-so/analytics-next/dist/pkg/plugins/ajs-destination/utils.js\nvar isInstallableIntegration = function isInstallableIntegration(name, integrationSettings) {\n  var _a;\n\n  var type = integrationSettings.type,\n      bundlingStatus = integrationSettings.bundlingStatus,\n      versionSettings = integrationSettings.versionSettings; // We use `!== 'unbundled'` (versus `=== 'bundled'`) to be inclusive of\n  // destinations without a defined value for `bundlingStatus`\n\n  var deviceMode = bundlingStatus !== 'unbundled' && (type === 'browser' || ((_a = versionSettings === null || versionSettings === void 0 ? void 0 : versionSettings.componentTypes) === null || _a === void 0 ? void 0 : _a.includes('browser'))); // checking for iterable is a quick fix we need in place to prevent\n  // errors showing Iterable as a failed destiantion. Ideally, we should\n  // fix the Iterable metadata instead, but that's a longer process.\n\n  return !name.startsWith('Segment') && name !== 'Iterable' && deviceMode;\n};\nvar isDisabledIntegration = function isDisabledIntegration(integrationName, globalIntegrations) {\n  var allDisableAndNotDefined = globalIntegrations.All === false && globalIntegrations[integrationName] === undefined;\n  return globalIntegrations[integrationName] === false || allDisableAndNotDefined;\n};\n// CONCATENATED MODULE: ./node_modules/@june-so/analytics-next/dist/pkg/plugins/ajs-destination/index.js\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nfunction flushQueue(xt, queue) {\n  return Object(tslib_es6[\"b\" /* __awaiter */])(this, void 0, void 0, function () {\n    var failedQueue;\n\n    var _this = this;\n\n    return Object(tslib_es6[\"d\" /* __generator */])(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          failedQueue = [];\n\n          if (Object(connection[\"a\" /* isOffline */])()) {\n            return [2\n            /*return*/\n            , queue];\n          }\n\n          return [4\n          /*yield*/\n          , Object(p_while[\"a\" /* pWhile */])(function () {\n            return queue.length > 0 && Object(connection[\"b\" /* isOnline */])();\n          }, function () {\n            return Object(tslib_es6[\"b\" /* __awaiter */])(_this, void 0, void 0, function () {\n              var ctx, result, success;\n              return Object(tslib_es6[\"d\" /* __generator */])(this, function (_a) {\n                switch (_a.label) {\n                  case 0:\n                    ctx = queue.pop();\n\n                    if (!ctx) {\n                      return [2\n                      /*return*/\n                      ];\n                    }\n\n                    return [4\n                    /*yield*/\n                    , Object(delivery[\"a\" /* attempt */])(ctx, xt)];\n\n                  case 1:\n                    result = _a.sent();\n                    success = result instanceof context[\"a\" /* Context */];\n\n                    if (!success) {\n                      failedQueue.push(ctx);\n                    }\n\n                    return [2\n                    /*return*/\n                    ];\n                }\n              });\n            });\n          }) // re-add failed tasks\n          ];\n\n        case 1:\n          _a.sent(); // re-add failed tasks\n\n\n          failedQueue.map(function (failed) {\n            return queue.pushWithBackoff(failed);\n          });\n          return [2\n          /*return*/\n          , queue];\n      }\n    });\n  });\n}\n\nvar ajs_destination_LegacyDestination =\n/** @class */\nfunction () {\n  function LegacyDestination(name, version, settings, options, integrationSource) {\n    if (settings === void 0) {\n      settings = {};\n    }\n\n    this.options = {};\n    this.type = 'destination';\n    this.middleware = [];\n    this._ready = false;\n    this._initialized = false;\n    this.flushing = false;\n    this.name = name;\n    this.version = version;\n    this.settings = Object(tslib_es6[\"a\" /* __assign */])({}, settings);\n    this.disableAutoISOConversion = options.disableAutoISOConversion || false;\n    this.integrationSource = integrationSource; // AJS-Renderer sets an extraneous `type` setting that clobbers\n    // existing type defaults. We need to remove it if it's present\n\n    if (this.settings['type'] && this.settings['type'] === 'browser') {\n      delete this.settings['type'];\n    }\n\n    this.options = options;\n    this.buffer = options.disableClientPersistence ? new priority_queue[\"b\" /* PriorityQueue */](4, []) : new persisted[\"a\" /* PersistedPriorityQueue */](4, \"dest-\".concat(name));\n    this.scheduleFlush();\n  }\n\n  LegacyDestination.prototype.isLoaded = function () {\n    return this._ready;\n  };\n\n  LegacyDestination.prototype.ready = function () {\n    var _a;\n\n    return (_a = this.onReady) !== null && _a !== void 0 ? _a : Promise.resolve();\n  };\n\n  LegacyDestination.prototype.load = function (ctx, analyticsInstance) {\n    var _a;\n\n    return Object(tslib_es6[\"b\" /* __awaiter */])(this, void 0, void 0, function () {\n      var integrationSource, _b;\n\n      var _this = this;\n\n      return Object(tslib_es6[\"d\" /* __generator */])(this, function (_c) {\n        switch (_c.label) {\n          case 0:\n            if (this._ready || this.onReady !== undefined) {\n              return [2\n              /*return*/\n              ];\n            }\n\n            if (!((_a = this.integrationSource) !== null && _a !== void 0)) return [3\n            /*break*/\n            , 1];\n            _b = _a;\n            return [3\n            /*break*/\n            , 3];\n\n          case 1:\n            return [4\n            /*yield*/\n            , loadIntegration(ctx, this.name, this.version, this.options.obfuscate)];\n\n          case 2:\n            _b = _c.sent();\n            _c.label = 3;\n\n          case 3:\n            integrationSource = _b;\n            this.integration = buildIntegration(integrationSource, this.settings, analyticsInstance);\n            this.onReady = new Promise(function (resolve) {\n              var onReadyFn = function onReadyFn() {\n                _this._ready = true;\n                resolve(true);\n              };\n\n              _this.integration.once('ready', onReadyFn);\n            });\n            this.onInitialize = new Promise(function (resolve) {\n              var onInit = function onInit() {\n                _this._initialized = true;\n                resolve(true);\n              };\n\n              _this.integration.on('initialize', onInit);\n            });\n\n            try {\n              ctx.stats.increment('analytics_js.integration.invoke', 1, [\"method:initialize\", \"integration_name:\".concat(this.name)]);\n              this.integration.initialize();\n            } catch (error) {\n              ctx.stats.increment('analytics_js.integration.invoke.error', 1, [\"method:initialize\", \"integration_name:\".concat(this.name)]);\n              throw error;\n            }\n\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  LegacyDestination.prototype.unload = function (_ctx, _analyticsInstance) {\n    return unloadIntegration(this.name, this.version, this.options.obfuscate);\n  };\n\n  LegacyDestination.prototype.addMiddleware = function () {\n    var _a;\n\n    var fn = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      fn[_i] = arguments[_i];\n    }\n\n    this.middleware = (_a = this.middleware).concat.apply(_a, fn);\n  };\n\n  LegacyDestination.prototype.shouldBuffer = function (ctx) {\n    return (// page events can't be buffered because of destinations that automatically add page views\n      ctx.event.type !== 'page' && (Object(connection[\"a\" /* isOffline */])() || this._ready === false || this._initialized === false)\n    );\n  };\n\n  LegacyDestination.prototype.send = function (ctx, clz, eventType) {\n    var _a, _b;\n\n    return Object(tslib_es6[\"b\" /* __awaiter */])(this, void 0, void 0, function () {\n      var plan, ev, planEvent, afterMiddleware, event, err_1;\n      return Object(tslib_es6[\"d\" /* __generator */])(this, function (_c) {\n        switch (_c.label) {\n          case 0:\n            if (this.shouldBuffer(ctx)) {\n              this.buffer.push(ctx);\n              this.scheduleFlush();\n              return [2\n              /*return*/\n              , ctx];\n            }\n\n            plan = (_b = (_a = this.options) === null || _a === void 0 ? void 0 : _a.plan) === null || _b === void 0 ? void 0 : _b.track;\n            ev = ctx.event.event;\n\n            if (plan && ev && this.name !== 'june.so') {\n              planEvent = plan[ev];\n\n              if (!Object(is_plan_event_enabled[\"a\" /* isPlanEventEnabled */])(plan, planEvent)) {\n                ctx.updateEvent('integrations', Object(tslib_es6[\"a\" /* __assign */])(Object(tslib_es6[\"a\" /* __assign */])({}, ctx.event.integrations), {\n                  All: false,\n                  'june.so': true\n                }));\n                ctx.cancel(new esm_context[\"a\" /* ContextCancelation */]({\n                  retry: false,\n                  reason: \"Event \".concat(ev, \" disabled for integration \").concat(this.name, \" in tracking plan\"),\n                  type: 'Dropped by plan'\n                }));\n                return [2\n                /*return*/\n                , ctx];\n              } else {\n                ctx.updateEvent('integrations', Object(tslib_es6[\"a\" /* __assign */])(Object(tslib_es6[\"a\" /* __assign */])({}, ctx.event.integrations), planEvent === null || planEvent === void 0 ? void 0 : planEvent.integrations));\n              }\n\n              if ((planEvent === null || planEvent === void 0 ? void 0 : planEvent.enabled) && (planEvent === null || planEvent === void 0 ? void 0 : planEvent.integrations[this.name]) === false) {\n                ctx.cancel(new esm_context[\"a\" /* ContextCancelation */]({\n                  retry: false,\n                  reason: \"Event \".concat(ev, \" disabled for integration \").concat(this.name, \" in tracking plan\"),\n                  type: 'Dropped by plan'\n                }));\n                return [2\n                /*return*/\n                , ctx];\n              }\n            }\n\n            return [4\n            /*yield*/\n            , Object(middleware[\"applyDestinationMiddleware\"])(this.name, ctx.event, this.middleware)];\n\n          case 1:\n            afterMiddleware = _c.sent();\n\n            if (afterMiddleware === null) {\n              return [2\n              /*return*/\n              , ctx];\n            }\n\n            event = new clz(afterMiddleware, {\n              traverse: !this.disableAutoISOConversion\n            });\n            ctx.stats.increment('analytics_js.integration.invoke', 1, [\"method:\".concat(eventType), \"integration_name:\".concat(this.name)]);\n            _c.label = 2;\n\n          case 2:\n            _c.trys.push([2, 5,, 6]);\n\n            if (!this.integration) return [3\n            /*break*/\n            , 4];\n            return [4\n            /*yield*/\n            , this.integration.invoke.call(this.integration, eventType, event)];\n\n          case 3:\n            _c.sent();\n\n            _c.label = 4;\n\n          case 4:\n            return [3\n            /*break*/\n            , 6];\n\n          case 5:\n            err_1 = _c.sent();\n            ctx.stats.increment('analytics_js.integration.invoke.error', 1, [\"method:\".concat(eventType), \"integration_name:\".concat(this.name)]);\n            throw err_1;\n\n          case 6:\n            return [2\n            /*return*/\n            , ctx];\n        }\n      });\n    });\n  };\n\n  LegacyDestination.prototype.track = function (ctx) {\n    return Object(tslib_es6[\"b\" /* __awaiter */])(this, void 0, void 0, function () {\n      return Object(tslib_es6[\"d\" /* __generator */])(this, function (_a) {\n        return [2\n        /*return*/\n        , this.send(ctx, dist[\"Track\"], 'track')];\n      });\n    });\n  };\n\n  LegacyDestination.prototype.page = function (ctx) {\n    var _a;\n\n    return Object(tslib_es6[\"b\" /* __awaiter */])(this, void 0, void 0, function () {\n      var _this = this;\n\n      return Object(tslib_es6[\"d\" /* __generator */])(this, function (_b) {\n        if (((_a = this.integration) === null || _a === void 0 ? void 0 : _a._assumesPageview) && !this._initialized) {\n          this.integration.initialize();\n        }\n\n        return [2\n        /*return*/\n        , this.onInitialize.then(function () {\n          return _this.send(ctx, dist[\"Page\"], 'page');\n        })];\n      });\n    });\n  };\n\n  LegacyDestination.prototype.identify = function (ctx) {\n    return Object(tslib_es6[\"b\" /* __awaiter */])(this, void 0, void 0, function () {\n      return Object(tslib_es6[\"d\" /* __generator */])(this, function (_a) {\n        return [2\n        /*return*/\n        , this.send(ctx, dist[\"Identify\"], 'identify')];\n      });\n    });\n  };\n\n  LegacyDestination.prototype.alias = function (ctx) {\n    return Object(tslib_es6[\"b\" /* __awaiter */])(this, void 0, void 0, function () {\n      return Object(tslib_es6[\"d\" /* __generator */])(this, function (_a) {\n        return [2\n        /*return*/\n        , this.send(ctx, dist[\"Alias\"], 'alias')];\n      });\n    });\n  };\n\n  LegacyDestination.prototype.group = function (ctx) {\n    return Object(tslib_es6[\"b\" /* __awaiter */])(this, void 0, void 0, function () {\n      return Object(tslib_es6[\"d\" /* __generator */])(this, function (_a) {\n        return [2\n        /*return*/\n        , this.send(ctx, dist[\"Group\"], 'group')];\n      });\n    });\n  };\n\n  LegacyDestination.prototype.scheduleFlush = function () {\n    var _this = this;\n\n    if (this.flushing) {\n      return;\n    } // eslint-disable-next-line @typescript-eslint/no-misused-promises\n\n\n    setTimeout(function () {\n      return Object(tslib_es6[\"b\" /* __awaiter */])(_this, void 0, void 0, function () {\n        var _a;\n\n        return Object(tslib_es6[\"d\" /* __generator */])(this, function (_b) {\n          switch (_b.label) {\n            case 0:\n              this.flushing = true;\n              _a = this;\n              return [4\n              /*yield*/\n              , flushQueue(this, this.buffer)];\n\n            case 1:\n              _a.buffer = _b.sent();\n              this.flushing = false;\n\n              if (this.buffer.todo > 0) {\n                this.scheduleFlush();\n              }\n\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    }, Math.random() * 5000);\n  };\n\n  return LegacyDestination;\n}();\n\n\nfunction ajsDestinations(settings, globalIntegrations, options, routingMiddleware, legacyIntegrationSources) {\n  var _a, _b;\n\n  if (globalIntegrations === void 0) {\n    globalIntegrations = {};\n  }\n\n  if (options === void 0) {\n    options = {};\n  }\n\n  if (Object(environment[\"b\" /* isServer */])()) {\n    return [];\n  }\n\n  if (settings.plan) {\n    options = options !== null && options !== void 0 ? options : {};\n    options.plan = settings.plan;\n  }\n\n  var routingRules = (_b = (_a = settings.middlewareSettings) === null || _a === void 0 ? void 0 : _a.routingRules) !== null && _b !== void 0 ? _b : [];\n  var remoteIntegrationsConfig = settings.integrations;\n  var localIntegrationsConfig = options.integrations; // merged remote CDN settings with user provided options\n\n  var integrationOptions = Object(merged_options[\"a\" /* mergedOptions */])(settings, options !== null && options !== void 0 ? options : {});\n  var adhocIntegrationSources = legacyIntegrationSources === null || legacyIntegrationSources === void 0 ? void 0 : legacyIntegrationSources.reduce(function (acc, integrationSource) {\n    var _a;\n\n    return Object(tslib_es6[\"a\" /* __assign */])(Object(tslib_es6[\"a\" /* __assign */])({}, acc), (_a = {}, _a[resolveIntegrationNameFromSource(integrationSource)] = integrationSource, _a));\n  }, {});\n  var installableIntegrations = new Set(Object(tslib_es6[\"f\" /* __spreadArray */])(Object(tslib_es6[\"f\" /* __spreadArray */])([], Object.keys(remoteIntegrationsConfig).filter(function (name) {\n    return isInstallableIntegration(name, remoteIntegrationsConfig[name]);\n  }), true), Object.keys(adhocIntegrationSources || {}).filter(function (name) {\n    return Object(helpers[\"a\" /* isPlainObject */])(remoteIntegrationsConfig[name]) || Object(helpers[\"a\" /* isPlainObject */])(localIntegrationsConfig === null || localIntegrationsConfig === void 0 ? void 0 : localIntegrationsConfig[name]);\n  }), true));\n  return Array.from(installableIntegrations).filter(function (name) {\n    return !isDisabledIntegration(name, globalIntegrations);\n  }).map(function (name) {\n    var integrationSettings = remoteIntegrationsConfig[name];\n    var version = resolveVersion(integrationSettings);\n    var destination = new ajs_destination_LegacyDestination(name, version, integrationOptions[name], options, adhocIntegrationSources === null || adhocIntegrationSources === void 0 ? void 0 : adhocIntegrationSources[name]);\n    var routing = routingRules.filter(function (rule) {\n      return rule.destinationName === name;\n    });\n\n    if (routing.length > 0 && routingMiddleware) {\n      destination.addMiddleware(routingMiddleware);\n    }\n\n    return destination;\n  });\n}\n\n/***/ })\n\n}]);","inputSourceMap":{"version":3,"sources":["/home/chatwoot/chatwoot/node_modules/babel-loader/lib/index.js??ref--6-0!/home/chatwoot/chatwoot/node_modules/@june-so/analytics-next/dist/pkg/lib/is-plan-event-enabled.js","/home/chatwoot/chatwoot/node_modules/babel-loader/lib/index.js??ref--6-0!/home/chatwoot/chatwoot/node_modules/@segment/analytics-core/dist/esm/validation/helpers.js","/home/chatwoot/chatwoot/node_modules/babel-loader/lib/index.js??ref--6-0!/home/chatwoot/chatwoot/node_modules/@june-so/analytics-next/dist/pkg/plugins/ajs-destination/loader.js","/home/chatwoot/chatwoot/node_modules/babel-loader/lib/index.js??ref--6-0!/home/chatwoot/chatwoot/node_modules/@june-so/analytics-next/dist/pkg/plugins/ajs-destination/utils.js","/home/chatwoot/chatwoot/node_modules/babel-loader/lib/index.js??ref--6-0!/home/chatwoot/chatwoot/node_modules/@june-so/analytics-next/dist/pkg/plugins/ajs-destination/index.js"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACO;AACP,aAAa;;;AAGb;AACA;AACA,GAAG;;;AAGH;AACA,C;;;;;;;;AChBA;AAAA;AAAA;AAAA;AAAA;AAAO;AACP;AACA;AACO;AACP;AACA;AACO;AACP;AACA;AACO;AACP;AACA;AACO;AACP;;AAEA;AACA;AACA,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACjB8D;AACD;AACI;;AAEjE;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEO;AACP;AACA;;AAEA;AACA;;AAEA;AACA,0NAA0N;;AAE1N,sFAAsF,0CAAa;AACnG,GAAG,YAAY;AACf;AACA;;AAEO;AACP,qBAAqB;;AAErB;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;AACO;AACP,SAAS,sCAAS;AAClB;AACA,WAAW,wCAAW;AACtB;AACA;AACA;AACA;AACA,iBAAiB,mDAAsB;AACvC;AACA;;AAEA;AACA;;AAEA;AACA;AACA,YAAY,yCAAU;;AAEtB;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,mBAAmB,yCAAU;AAC7B,WAAW;AACX;;AAEA;AACA,oBAAoB;;;AAGpB;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;AACH;AACO;AACP,SAAS,sCAAS;AAClB;AACA,WAAW,wCAAW;AACtB,aAAa,mDAAsB;AACnC;AACA;AACA;AACA;AACA;AACA,QAAQ,2CAAY;AACpB,KAAK;AACL,GAAG;AACH;AACO;AACP;;AAEA;AACA,C;;;;;AC3HO;AACP;;AAEA;AACA;AACA,4DAA4D;AAC5D;;AAEA,mPAAmP;AACnP;AACA;;AAEA;AACA;AACO;AACP;AACA;AACA,E;;ACjBwE;AACF;AACV;AACK;AACf;AACA;AACmB;AACZ;AACd;AACc;AACmB;AACjB;AACuE;AAC1E;AAC2C;;AAEnG;AACA,SAAS,sCAAS;AAClB;;AAEA;;AAEA,WAAW,wCAAW;AACtB;AACA;AACA;;AAEA,cAAc,uCAAS;AACvB;AACA;AACA;AACA;;AAEA;AACA;AACA,YAAY,iCAAM;AAClB,uCAAuC,sCAAQ;AAC/C,WAAW;AACX,mBAAmB,sCAAS;AAC5B;AACA,qBAAqB,wCAAW;AAChC;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,sBAAsB,mCAAO;;AAE7B;AACA;AACA,gDAAgD,0BAAO;;AAEvD;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,eAAe;AACf,aAAa;AACb,WAAW;AACX;;AAEA;AACA,oBAAoB;;;AAGpB;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;AACH;;AAEA,IAAI,iCAAiB;AACrB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB,qCAAQ,GAAG;AAC/B;AACA,+CAA+C;AAC/C;;AAEA;AACA;AACA;;AAEA;AACA,yDAAyD,uCAAa,cAAc,2CAAsB;AAC1G;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA,WAAW,sCAAS;AACpB;;AAEA;;AAEA,aAAa,wCAAW;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,cAAc,eAAe;;AAE7B;AACA;AACA;;AAEA;AACA;AACA,+BAA+B,gBAAgB;AAC/C;AACA;AACA;AACA;AACA;;AAEA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;;AAEA;AACA,aAAa;;AAEb;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;;AAEA;AACA,WAAW,iBAAiB;AAC5B;;AAEA;AACA;;AAEA;;AAEA,oBAAoB,uBAAuB;AAC3C;AACA;;AAEA;AACA;;AAEA;AACA;AACA,oCAAoC,uCAAS;AAC7C;AACA;;AAEA;AACA;;AAEA,WAAW,sCAAS;AACpB;AACA,aAAa,wCAAW;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA,mBAAmB,2DAAkB;AACrC,gDAAgD,qCAAQ,CAAC,qCAAQ,GAAG;AACpE;AACA;AACA,iBAAiB;AACjB,+BAA+B,yCAAkB;AACjD;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA,eAAe;AACf,gDAAgD,qCAAQ,CAAC,qCAAQ,GAAG;AACpE;;AAEA;AACA,+BAA+B,yCAAkB;AACjD;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,cAAc,gDAA0B;;AAExC;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;;AAEA;AACA,WAAW,sCAAS;AACpB,aAAa,wCAAW;AACxB;AACA;AACA,yBAAyB,aAAK;AAC9B,OAAO;AACP,KAAK;AACL;;AAEA;AACA;;AAEA,WAAW,sCAAS;AACpB;;AAEA,aAAa,wCAAW;AACxB;AACA;AACA;;AAEA;AACA;AACA;AACA,iCAAiC,YAAI;AACrC,SAAS;AACT,OAAO;AACP,KAAK;AACL;;AAEA;AACA,WAAW,sCAAS;AACpB,aAAa,wCAAW;AACxB;AACA;AACA,yBAAyB,gBAAQ;AACjC,OAAO;AACP,KAAK;AACL;;AAEA;AACA,WAAW,sCAAS;AACpB,aAAa,wCAAW;AACxB;AACA;AACA,yBAAyB,aAAK;AAC9B,OAAO;AACP,KAAK;AACL;;AAEA;AACA,WAAW,sCAAS;AACpB,aAAa,wCAAW;AACxB;AACA;AACA,yBAAyB,aAAK;AAC9B,OAAO;AACP,KAAK;AACL;;AAEA;AACA;;AAEA;AACA;AACA,KAAK;;;AAGL;AACA,aAAa,sCAAS;AACtB;;AAEA,eAAe,wCAAW;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP,KAAK;AACL;;AAEA;AACA,CAAC;;AAE4B;AACtB;AACP;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,MAAM,uCAAQ;AACd;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,qDAAqD;;AAErD,2BAA2B,+CAAa,gEAAgE;AACxG;AACA;;AAEA,WAAW,qCAAQ,CAAC,qCAAQ,GAAG,gBAAgB,KAAK,gCAAgC;AACpF,GAAG,IAAI;AACP,wCAAwC,0CAAa,CAAC,0CAAa;AACnE,WAAW,wBAAwB;AACnC,GAAG,mDAAmD;AACtD,WAAW,wCAAa,oCAAoC,wCAAa;AACzE,GAAG;AACH;AACA,YAAY,qBAAqB;AACjC,GAAG;AACH;AACA,kBAAkB,cAAc;AAChC,0BAA0B,iCAAiB;AAC3C;AACA;AACA,KAAK;;AAEL;AACA;AACA;;AAEA;AACA,GAAG;AACH,C","file":"x","sourcesContent":["/**\n * Determines whether a track event is allowed to be sent based on the\n * user's tracking plan.\n * If the user does not have a tracking plan or the event is allowed based\n * on the tracking plan configuration, returns true.\n */\nexport function isPlanEventEnabled(plan, planEvent) {\n  var _a, _b; // Always prioritize the event's `enabled` status\n\n\n  if (typeof (planEvent === null || planEvent === void 0 ? void 0 : planEvent.enabled) === 'boolean') {\n    return planEvent.enabled;\n  } // Assume absence of a tracking plan means events are enabled\n\n\n  return (_b = (_a = plan === null || plan === void 0 ? void 0 : plan.__default) === null || _a === void 0 ? void 0 : _a.enabled) !== null && _b !== void 0 ? _b : true;\n}","export function isString(obj) {\n  return typeof obj === 'string';\n}\nexport function isNumber(obj) {\n  return typeof obj === 'number';\n}\nexport function isFunction(obj) {\n  return typeof obj === 'function';\n}\nexport function isPlainObject(obj) {\n  return Object.prototype.toString.call(obj).slice(8, -1).toLowerCase() === 'object';\n}\nexport function hasUser(event) {\n  var _a, _b, _c;\n\n  var id = (_c = (_b = (_a = event.userId) !== null && _a !== void 0 ? _a : event.anonymousId) !== null && _b !== void 0 ? _b : event.groupId) !== null && _c !== void 0 ? _c : event.previousId;\n  return isString(id);\n}","import { __awaiter, __generator, __spreadArray } from \"tslib\";\nimport { getNextIntegrationsURL } from '../../lib/parse-cdn';\nimport { loadScript, unloadScript } from '../../lib/load-script';\n\nfunction normalizeName(name) {\n  return name.toLowerCase().replace('.', '').replace(/\\s+/g, '-');\n}\n\nfunction obfuscatePathName(pathName, obfuscate) {\n  if (obfuscate === void 0) {\n    obfuscate = false;\n  }\n\n  return obfuscate ? btoa(pathName).replace(/=/g, '') : undefined;\n}\n\nexport function resolveIntegrationNameFromSource(integrationSource) {\n  return ('Integration' in integrationSource ? integrationSource.Integration : integrationSource).prototype.name;\n}\n\nfunction recordLoadMetrics(fullPath, ctx, name) {\n  var _a, _b;\n\n  try {\n    var metric = ((_b = (_a = window === null || window === void 0 ? void 0 : window.performance) === null || _a === void 0 ? void 0 : _a.getEntriesByName(fullPath, 'resource')) !== null && _b !== void 0 ? _b : [])[0]; // we assume everything that took under 100ms is cached\n\n    metric && ctx.stats.gauge('legacy_destination_time', Math.round(metric.duration), __spreadArray([name], metric.duration < 100 ? ['cached'] : [], true));\n  } catch (_) {// not available\n  }\n}\n\nexport function buildIntegration(integrationSource, integrationSettings, analyticsInstance) {\n  var integrationCtr; // GA and Appcues use a different interface to instantiating integrations\n\n  if ('Integration' in integrationSource) {\n    var analyticsStub = {\n      user: function user() {\n        return analyticsInstance.user();\n      },\n      addIntegration: function addIntegration() {}\n    };\n    integrationSource(analyticsStub);\n    integrationCtr = integrationSource.Integration;\n  } else {\n    integrationCtr = integrationSource;\n  }\n\n  var integration = new integrationCtr(integrationSettings);\n  integration.analytics = analyticsInstance;\n  return integration;\n}\nexport function loadIntegration(ctx, name, version, obfuscate) {\n  return __awaiter(this, void 0, void 0, function () {\n    var pathName, obfuscatedPathName, path, fullPath, err_1, deps;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          pathName = normalizeName(name);\n          obfuscatedPathName = obfuscatePathName(pathName, obfuscate);\n          path = getNextIntegrationsURL();\n          fullPath = \"\".concat(path, \"/integrations/\").concat(obfuscatedPathName !== null && obfuscatedPathName !== void 0 ? obfuscatedPathName : pathName, \"/\").concat(version, \"/\").concat(obfuscatedPathName !== null && obfuscatedPathName !== void 0 ? obfuscatedPathName : pathName, \".dynamic.js.gz\");\n          _a.label = 1;\n\n        case 1:\n          _a.trys.push([1, 3,, 4]);\n\n          return [4\n          /*yield*/\n          , loadScript(fullPath)];\n\n        case 2:\n          _a.sent();\n\n          recordLoadMetrics(fullPath, ctx, name);\n          return [3\n          /*break*/\n          , 4];\n\n        case 3:\n          err_1 = _a.sent();\n          ctx.stats.gauge('legacy_destination_time', -1, [\"plugin:\".concat(name), \"failed\"]);\n          throw err_1;\n\n        case 4:\n          deps = window[\"\".concat(pathName, \"Deps\")];\n          return [4\n          /*yield*/\n          , Promise.all(deps.map(function (dep) {\n            return loadScript(path + dep + '.gz');\n          })) // @ts-ignore\n          ];\n\n        case 5:\n          _a.sent(); // @ts-ignore\n\n\n          window[\"\".concat(pathName, \"Loader\")]();\n          return [2\n          /*return*/\n          , window[// @ts-ignore\n          \"\".concat(pathName, \"Integration\")]];\n      }\n    });\n  });\n}\nexport function unloadIntegration(name, version, obfuscate) {\n  return __awaiter(this, void 0, void 0, function () {\n    var path, pathName, obfuscatedPathName, fullPath;\n    return __generator(this, function (_a) {\n      path = getNextIntegrationsURL();\n      pathName = normalizeName(name);\n      obfuscatedPathName = obfuscatePathName(name, obfuscate);\n      fullPath = \"\".concat(path, \"/integrations/\").concat(obfuscatedPathName !== null && obfuscatedPathName !== void 0 ? obfuscatedPathName : pathName, \"/\").concat(version, \"/\").concat(obfuscatedPathName !== null && obfuscatedPathName !== void 0 ? obfuscatedPathName : pathName, \".dynamic.js.gz\");\n      return [2\n      /*return*/\n      , unloadScript(fullPath)];\n    });\n  });\n}\nexport function resolveVersion(settings) {\n  var _a, _b, _c, _d;\n\n  return (_d = (_b = (_a = settings === null || settings === void 0 ? void 0 : settings.versionSettings) === null || _a === void 0 ? void 0 : _a.override) !== null && _b !== void 0 ? _b : (_c = settings === null || settings === void 0 ? void 0 : settings.versionSettings) === null || _c === void 0 ? void 0 : _c.version) !== null && _d !== void 0 ? _d : 'latest';\n}","export var isInstallableIntegration = function isInstallableIntegration(name, integrationSettings) {\n  var _a;\n\n  var type = integrationSettings.type,\n      bundlingStatus = integrationSettings.bundlingStatus,\n      versionSettings = integrationSettings.versionSettings; // We use `!== 'unbundled'` (versus `=== 'bundled'`) to be inclusive of\n  // destinations without a defined value for `bundlingStatus`\n\n  var deviceMode = bundlingStatus !== 'unbundled' && (type === 'browser' || ((_a = versionSettings === null || versionSettings === void 0 ? void 0 : versionSettings.componentTypes) === null || _a === void 0 ? void 0 : _a.includes('browser'))); // checking for iterable is a quick fix we need in place to prevent\n  // errors showing Iterable as a failed destiantion. Ideally, we should\n  // fix the Iterable metadata instead, but that's a longer process.\n\n  return !name.startsWith('Segment') && name !== 'Iterable' && deviceMode;\n};\nexport var isDisabledIntegration = function isDisabledIntegration(integrationName, globalIntegrations) {\n  var allDisableAndNotDefined = globalIntegrations.All === false && globalIntegrations[integrationName] === undefined;\n  return globalIntegrations[integrationName] === false || allDisableAndNotDefined;\n};","import { __assign, __awaiter, __generator, __spreadArray } from \"tslib\";\nimport { Alias, Group, Identify, Page, Track } from '@segment/facade';\nimport { isOffline, isOnline } from '../../core/connection';\nimport { Context, ContextCancelation } from '../../core/context';\nimport { isServer } from '../../core/environment';\nimport { attempt } from '@segment/analytics-core';\nimport { isPlanEventEnabled } from '../../lib/is-plan-event-enabled';\nimport { mergedOptions } from '../../lib/merged-options';\nimport { pWhile } from '../../lib/p-while';\nimport { PriorityQueue } from '../../lib/priority-queue';\nimport { PersistedPriorityQueue } from '../../lib/priority-queue/persisted';\nimport { applyDestinationMiddleware } from '../middleware';\nimport { buildIntegration, loadIntegration, resolveIntegrationNameFromSource, resolveVersion, unloadIntegration } from './loader';\nimport { isPlainObject } from '@segment/analytics-core';\nimport { isDisabledIntegration as shouldSkipIntegration, isInstallableIntegration } from './utils';\n\nfunction flushQueue(xt, queue) {\n  return __awaiter(this, void 0, void 0, function () {\n    var failedQueue;\n\n    var _this = this;\n\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          failedQueue = [];\n\n          if (isOffline()) {\n            return [2\n            /*return*/\n            , queue];\n          }\n\n          return [4\n          /*yield*/\n          , pWhile(function () {\n            return queue.length > 0 && isOnline();\n          }, function () {\n            return __awaiter(_this, void 0, void 0, function () {\n              var ctx, result, success;\n              return __generator(this, function (_a) {\n                switch (_a.label) {\n                  case 0:\n                    ctx = queue.pop();\n\n                    if (!ctx) {\n                      return [2\n                      /*return*/\n                      ];\n                    }\n\n                    return [4\n                    /*yield*/\n                    , attempt(ctx, xt)];\n\n                  case 1:\n                    result = _a.sent();\n                    success = result instanceof Context;\n\n                    if (!success) {\n                      failedQueue.push(ctx);\n                    }\n\n                    return [2\n                    /*return*/\n                    ];\n                }\n              });\n            });\n          }) // re-add failed tasks\n          ];\n\n        case 1:\n          _a.sent(); // re-add failed tasks\n\n\n          failedQueue.map(function (failed) {\n            return queue.pushWithBackoff(failed);\n          });\n          return [2\n          /*return*/\n          , queue];\n      }\n    });\n  });\n}\n\nvar LegacyDestination =\n/** @class */\nfunction () {\n  function LegacyDestination(name, version, settings, options, integrationSource) {\n    if (settings === void 0) {\n      settings = {};\n    }\n\n    this.options = {};\n    this.type = 'destination';\n    this.middleware = [];\n    this._ready = false;\n    this._initialized = false;\n    this.flushing = false;\n    this.name = name;\n    this.version = version;\n    this.settings = __assign({}, settings);\n    this.disableAutoISOConversion = options.disableAutoISOConversion || false;\n    this.integrationSource = integrationSource; // AJS-Renderer sets an extraneous `type` setting that clobbers\n    // existing type defaults. We need to remove it if it's present\n\n    if (this.settings['type'] && this.settings['type'] === 'browser') {\n      delete this.settings['type'];\n    }\n\n    this.options = options;\n    this.buffer = options.disableClientPersistence ? new PriorityQueue(4, []) : new PersistedPriorityQueue(4, \"dest-\".concat(name));\n    this.scheduleFlush();\n  }\n\n  LegacyDestination.prototype.isLoaded = function () {\n    return this._ready;\n  };\n\n  LegacyDestination.prototype.ready = function () {\n    var _a;\n\n    return (_a = this.onReady) !== null && _a !== void 0 ? _a : Promise.resolve();\n  };\n\n  LegacyDestination.prototype.load = function (ctx, analyticsInstance) {\n    var _a;\n\n    return __awaiter(this, void 0, void 0, function () {\n      var integrationSource, _b;\n\n      var _this = this;\n\n      return __generator(this, function (_c) {\n        switch (_c.label) {\n          case 0:\n            if (this._ready || this.onReady !== undefined) {\n              return [2\n              /*return*/\n              ];\n            }\n\n            if (!((_a = this.integrationSource) !== null && _a !== void 0)) return [3\n            /*break*/\n            , 1];\n            _b = _a;\n            return [3\n            /*break*/\n            , 3];\n\n          case 1:\n            return [4\n            /*yield*/\n            , loadIntegration(ctx, this.name, this.version, this.options.obfuscate)];\n\n          case 2:\n            _b = _c.sent();\n            _c.label = 3;\n\n          case 3:\n            integrationSource = _b;\n            this.integration = buildIntegration(integrationSource, this.settings, analyticsInstance);\n            this.onReady = new Promise(function (resolve) {\n              var onReadyFn = function onReadyFn() {\n                _this._ready = true;\n                resolve(true);\n              };\n\n              _this.integration.once('ready', onReadyFn);\n            });\n            this.onInitialize = new Promise(function (resolve) {\n              var onInit = function onInit() {\n                _this._initialized = true;\n                resolve(true);\n              };\n\n              _this.integration.on('initialize', onInit);\n            });\n\n            try {\n              ctx.stats.increment('analytics_js.integration.invoke', 1, [\"method:initialize\", \"integration_name:\".concat(this.name)]);\n              this.integration.initialize();\n            } catch (error) {\n              ctx.stats.increment('analytics_js.integration.invoke.error', 1, [\"method:initialize\", \"integration_name:\".concat(this.name)]);\n              throw error;\n            }\n\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  LegacyDestination.prototype.unload = function (_ctx, _analyticsInstance) {\n    return unloadIntegration(this.name, this.version, this.options.obfuscate);\n  };\n\n  LegacyDestination.prototype.addMiddleware = function () {\n    var _a;\n\n    var fn = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      fn[_i] = arguments[_i];\n    }\n\n    this.middleware = (_a = this.middleware).concat.apply(_a, fn);\n  };\n\n  LegacyDestination.prototype.shouldBuffer = function (ctx) {\n    return (// page events can't be buffered because of destinations that automatically add page views\n      ctx.event.type !== 'page' && (isOffline() || this._ready === false || this._initialized === false)\n    );\n  };\n\n  LegacyDestination.prototype.send = function (ctx, clz, eventType) {\n    var _a, _b;\n\n    return __awaiter(this, void 0, void 0, function () {\n      var plan, ev, planEvent, afterMiddleware, event, err_1;\n      return __generator(this, function (_c) {\n        switch (_c.label) {\n          case 0:\n            if (this.shouldBuffer(ctx)) {\n              this.buffer.push(ctx);\n              this.scheduleFlush();\n              return [2\n              /*return*/\n              , ctx];\n            }\n\n            plan = (_b = (_a = this.options) === null || _a === void 0 ? void 0 : _a.plan) === null || _b === void 0 ? void 0 : _b.track;\n            ev = ctx.event.event;\n\n            if (plan && ev && this.name !== 'june.so') {\n              planEvent = plan[ev];\n\n              if (!isPlanEventEnabled(plan, planEvent)) {\n                ctx.updateEvent('integrations', __assign(__assign({}, ctx.event.integrations), {\n                  All: false,\n                  'june.so': true\n                }));\n                ctx.cancel(new ContextCancelation({\n                  retry: false,\n                  reason: \"Event \".concat(ev, \" disabled for integration \").concat(this.name, \" in tracking plan\"),\n                  type: 'Dropped by plan'\n                }));\n                return [2\n                /*return*/\n                , ctx];\n              } else {\n                ctx.updateEvent('integrations', __assign(__assign({}, ctx.event.integrations), planEvent === null || planEvent === void 0 ? void 0 : planEvent.integrations));\n              }\n\n              if ((planEvent === null || planEvent === void 0 ? void 0 : planEvent.enabled) && (planEvent === null || planEvent === void 0 ? void 0 : planEvent.integrations[this.name]) === false) {\n                ctx.cancel(new ContextCancelation({\n                  retry: false,\n                  reason: \"Event \".concat(ev, \" disabled for integration \").concat(this.name, \" in tracking plan\"),\n                  type: 'Dropped by plan'\n                }));\n                return [2\n                /*return*/\n                , ctx];\n              }\n            }\n\n            return [4\n            /*yield*/\n            , applyDestinationMiddleware(this.name, ctx.event, this.middleware)];\n\n          case 1:\n            afterMiddleware = _c.sent();\n\n            if (afterMiddleware === null) {\n              return [2\n              /*return*/\n              , ctx];\n            }\n\n            event = new clz(afterMiddleware, {\n              traverse: !this.disableAutoISOConversion\n            });\n            ctx.stats.increment('analytics_js.integration.invoke', 1, [\"method:\".concat(eventType), \"integration_name:\".concat(this.name)]);\n            _c.label = 2;\n\n          case 2:\n            _c.trys.push([2, 5,, 6]);\n\n            if (!this.integration) return [3\n            /*break*/\n            , 4];\n            return [4\n            /*yield*/\n            , this.integration.invoke.call(this.integration, eventType, event)];\n\n          case 3:\n            _c.sent();\n\n            _c.label = 4;\n\n          case 4:\n            return [3\n            /*break*/\n            , 6];\n\n          case 5:\n            err_1 = _c.sent();\n            ctx.stats.increment('analytics_js.integration.invoke.error', 1, [\"method:\".concat(eventType), \"integration_name:\".concat(this.name)]);\n            throw err_1;\n\n          case 6:\n            return [2\n            /*return*/\n            , ctx];\n        }\n      });\n    });\n  };\n\n  LegacyDestination.prototype.track = function (ctx) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        return [2\n        /*return*/\n        , this.send(ctx, Track, 'track')];\n      });\n    });\n  };\n\n  LegacyDestination.prototype.page = function (ctx) {\n    var _a;\n\n    return __awaiter(this, void 0, void 0, function () {\n      var _this = this;\n\n      return __generator(this, function (_b) {\n        if (((_a = this.integration) === null || _a === void 0 ? void 0 : _a._assumesPageview) && !this._initialized) {\n          this.integration.initialize();\n        }\n\n        return [2\n        /*return*/\n        , this.onInitialize.then(function () {\n          return _this.send(ctx, Page, 'page');\n        })];\n      });\n    });\n  };\n\n  LegacyDestination.prototype.identify = function (ctx) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        return [2\n        /*return*/\n        , this.send(ctx, Identify, 'identify')];\n      });\n    });\n  };\n\n  LegacyDestination.prototype.alias = function (ctx) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        return [2\n        /*return*/\n        , this.send(ctx, Alias, 'alias')];\n      });\n    });\n  };\n\n  LegacyDestination.prototype.group = function (ctx) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        return [2\n        /*return*/\n        , this.send(ctx, Group, 'group')];\n      });\n    });\n  };\n\n  LegacyDestination.prototype.scheduleFlush = function () {\n    var _this = this;\n\n    if (this.flushing) {\n      return;\n    } // eslint-disable-next-line @typescript-eslint/no-misused-promises\n\n\n    setTimeout(function () {\n      return __awaiter(_this, void 0, void 0, function () {\n        var _a;\n\n        return __generator(this, function (_b) {\n          switch (_b.label) {\n            case 0:\n              this.flushing = true;\n              _a = this;\n              return [4\n              /*yield*/\n              , flushQueue(this, this.buffer)];\n\n            case 1:\n              _a.buffer = _b.sent();\n              this.flushing = false;\n\n              if (this.buffer.todo > 0) {\n                this.scheduleFlush();\n              }\n\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    }, Math.random() * 5000);\n  };\n\n  return LegacyDestination;\n}();\n\nexport { LegacyDestination };\nexport function ajsDestinations(settings, globalIntegrations, options, routingMiddleware, legacyIntegrationSources) {\n  var _a, _b;\n\n  if (globalIntegrations === void 0) {\n    globalIntegrations = {};\n  }\n\n  if (options === void 0) {\n    options = {};\n  }\n\n  if (isServer()) {\n    return [];\n  }\n\n  if (settings.plan) {\n    options = options !== null && options !== void 0 ? options : {};\n    options.plan = settings.plan;\n  }\n\n  var routingRules = (_b = (_a = settings.middlewareSettings) === null || _a === void 0 ? void 0 : _a.routingRules) !== null && _b !== void 0 ? _b : [];\n  var remoteIntegrationsConfig = settings.integrations;\n  var localIntegrationsConfig = options.integrations; // merged remote CDN settings with user provided options\n\n  var integrationOptions = mergedOptions(settings, options !== null && options !== void 0 ? options : {});\n  var adhocIntegrationSources = legacyIntegrationSources === null || legacyIntegrationSources === void 0 ? void 0 : legacyIntegrationSources.reduce(function (acc, integrationSource) {\n    var _a;\n\n    return __assign(__assign({}, acc), (_a = {}, _a[resolveIntegrationNameFromSource(integrationSource)] = integrationSource, _a));\n  }, {});\n  var installableIntegrations = new Set(__spreadArray(__spreadArray([], Object.keys(remoteIntegrationsConfig).filter(function (name) {\n    return isInstallableIntegration(name, remoteIntegrationsConfig[name]);\n  }), true), Object.keys(adhocIntegrationSources || {}).filter(function (name) {\n    return isPlainObject(remoteIntegrationsConfig[name]) || isPlainObject(localIntegrationsConfig === null || localIntegrationsConfig === void 0 ? void 0 : localIntegrationsConfig[name]);\n  }), true));\n  return Array.from(installableIntegrations).filter(function (name) {\n    return !shouldSkipIntegration(name, globalIntegrations);\n  }).map(function (name) {\n    var integrationSettings = remoteIntegrationsConfig[name];\n    var version = resolveVersion(integrationSettings);\n    var destination = new LegacyDestination(name, version, integrationOptions[name], options, adhocIntegrationSources === null || adhocIntegrationSources === void 0 ? void 0 : adhocIntegrationSources[name]);\n    var routing = routingRules.filter(function (rule) {\n      return rule.destinationName === name;\n    });\n\n    if (routing.length > 0 && routingMiddleware) {\n      destination.addMiddleware(routingMiddleware);\n    }\n\n    return destination;\n  });\n}"]}}